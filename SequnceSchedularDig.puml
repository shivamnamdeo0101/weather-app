@startuml
title Weather Cache Scheduler (Refresh-or-Evict via Cache Service)

participant "Weather Cache Scheduler" as scheduler
participant "Cache Service (CRUD/Refresh/Evict APIs)" as service
participant "Weather Cache (Redis)" as cache
participant "Open Weather API" as api

scheduler -> service: Fetch all city metadata (hits, lastAccess) every 5 min
service -> cache: Read meta+data for all cities

loop
    scheduler -> scheduler: Loop over each city

    alt HOT Cities (hits ≥ 50)
        scheduler -> api: Fetch latest weather data
        api -> scheduler: Return data
        scheduler -> service: Refresh & update cache (TTL=5min, LFU)
        service -> cache: Store refreshed data
    else if MEDIUM Cities (20 ≤ hits < 50)
        scheduler -> api: Fetch latest weather data
        api -> scheduler: Return data
        scheduler -> service: Refresh & update cache (TTL=15min)
        service -> cache: Store refreshed data
    else LOW/Inactive Cities (hits < 20)
        scheduler -> service: Evict city if age > 1 hour
        service -> cache: Evict city (LRU)
    end
scheduler -> scheduler: Repeat evaluation every 5 min

end

@enduml
